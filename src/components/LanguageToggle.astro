---
// Globe-based language toggle with translation support
// Supports: ES, EN, æ—¥æœ¬èªž, ä¸­æ–‡
---

<div class="lang-toggle-container">
  <button class="globe-btn" id="globeToggle" title="Change Language">
    <svg class="globe-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
      <circle cx="12" cy="12" r="10"/>
      <ellipse cx="12" cy="12" rx="4" ry="10"/>
      <path d="M2 12h20"/>
      <path d="M12 2c2.5 2.5 4 5.5 4 10s-1.5 7.5-4 10"/>
      <path d="M12 2c-2.5 2.5-4 5.5-4 10s1.5 7.5 4 10"/>
    </svg>
  </button>
  
  <!-- Dropdown menu -->
  <div class="lang-dropdown" id="langDropdown">
    <button class="lang-option" data-lang="es">
      <span class="lang-flag">ðŸ‡ªðŸ‡¸</span>
      <span>EspaÃ±ol</span>
    </button>
    <button class="lang-option" data-lang="en">
      <span class="lang-flag">ðŸ‡ºðŸ‡¸</span>
      <span>English</span>
    </button>
    <button class="lang-option" data-lang="ja">
      <span class="lang-flag">ðŸ‡¯ðŸ‡µ</span>
      <span>æ—¥æœ¬èªž</span>
    </button>
    <button class="lang-option" data-lang="zh">
      <span class="lang-flag">ðŸ‡¨ðŸ‡³</span>
      <span>ä¸­æ–‡</span>
    </button>
  </div>
</div>

<style>
  .lang-toggle-container {
    position: relative;
  }

  .globe-btn {
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid rgba(255, 255, 255, 0.5);
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
    padding: 6px;
  }

  .globe-btn:hover {
    border-color: rgba(255, 255, 255, 0.9);
    background: rgba(255, 255, 255, 0.2);
    transform: scale(1.1);
  }

  .globe-icon {
    width: 24px;
    height: 24px;
    stroke: white;
  }

  .lang-dropdown {
    position: absolute;
    top: 100%;
    right: 0;
    margin-top: 0.5rem;
    background: rgba(15, 23, 42, 0.95);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(100, 116, 139, 0.3);
    border-radius: 0.75rem;
    padding: 0.5rem;
    min-width: 140px;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.2s ease;
    z-index: 100;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
  }

  .lang-dropdown.open {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .lang-option {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    width: 100%;
    padding: 0.6rem 0.75rem;
    background: transparent;
    border: none;
    color: #cbd5e1;
    font-size: 0.875rem;
    font-family: inherit;
    cursor: pointer;
    border-radius: 0.5rem;
    transition: all 0.15s ease;
    text-align: left;
  }

  .lang-option:hover {
    background: rgba(59, 130, 246, 0.15);
    color: #ffffff;
  }

  .lang-option.active {
    background: rgba(59, 130, 246, 0.2);
    color: #60a5fa;
  }

  .lang-flag {
    font-size: 1.1rem;
  }

  @media (max-width: 640px) {
    .globe-btn {
      width: 32px;
      height: 32px;
    }

    .globe-icon {
      width: 18px;
      height: 18px;
    }
  }
</style>

<script>
  // Translations object
  const translations: Record<string, Record<string, string>> = {
    es: {
      // Keep Spanish as default - no changes needed
    },
    en: {
      // Hero info labels
      "Studying:": "Studying:",
      "CV:": "CV:",
      "Website:": "Website:",
      "Email:": "Email:",
      "City:": "City:",
      "Computer Science Undergrad": "Computer Science Undergrad",
      // Bio paragraph
      "Actualmente curso Ciencias de la ComputaciÃ³n en la": "Currently studying Computer Science at",
      "UNAL": "UNAL",
      ". Mi formaciÃ³n combina fundamentos matemÃ¡ticos y computacionales con aspectos artÃ­sticos, resultando en interÃ©s en el Ã¡rea de IA aplicada a la mÃºsica o procesamiento de sonido, y herramientas para el aprendizaje de idiomas.": ". My education combines mathematical and computational foundations with artistic aspects, resulting in interest in AI applied to music or sound processing, and language learning tools.",
      // About section
      "Sobre MÃ­": "About Me",
      "ðŸ”¬ InvestigaciÃ³n": "ðŸ”¬ Research",
      "ðŸŽµ Intereses": "ðŸŽµ Interests",
      "Participo en el": "I participate in the",
      "SIMG â€” Seminario de InvestigaciÃ³n en Modelos Generativos": "SIMG â€” Generative Models Research Seminar",
      ", donde exploramos Deep Learning, TopologÃ­a, TeorÃ­a de la InformaciÃ³n y Probabilidad.": ", where we explore Deep Learning, Topology, Information Theory and Probability.",
      // Interests
      "MÃºsica + IA:": "Music + AI:",
      "GeneraciÃ³n de audio con modelos generativos": "Audio generation with generative models",
      "NLP:": "NLP:",
      "Procesamiento de lenguaje para japonÃ©s y chino": "Language processing for Japanese and Chinese",
      "Seguridad:": "Security:",
      "Ciberseguridad y programaciÃ³n competitiva": "Cybersecurity and competitive programming",
      // Blog section
      "Blog & Publicaciones": "Blog & Publications",
      // Contact section
      "Contacto": "Contact",
      "ðŸ“± Otras formas de contacto": "ðŸ“± Other ways to contact",
      "ðŸŒ Redes Sociales": "ðŸŒ Social Media",
      "Email Personal": "Personal Email",
      "Email AcadÃ©mico": "Academic Email",
      // Navigation
      "Inicio": "Home",
      "Blog": "Blog",
      "Publicaciones": "Publications",
    },
    ja: {
      // Hero info labels
      "Studying:": "å°‚æ”»:",
      "CV:": "å±¥æ­´æ›¸:",
      "Website:": "ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆ:",
      "Email:": "ãƒ¡ãƒ¼ãƒ«:",
      "City:": "éƒ½å¸‚:",
      "Computer Science Undergrad": "ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹å­¦éƒ¨ç”Ÿ",
      // Bio
      "Actualmente curso Ciencias de la ComputaciÃ³n en la": "ç¾åœ¨",
      "UNAL": "ã‚³ãƒ­ãƒ³ãƒ“ã‚¢å›½ç«‹å¤§å­¦",
      ". Mi formaciÃ³n combina fundamentos matemÃ¡ticos y computacionales con aspectos artÃ­sticos, resultando en interÃ©s en el Ã¡rea de IA aplicada a la mÃºsica o procesamiento de sonido, y herramientas para el aprendizaje de idiomas.": "ã§ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹ã‚’å­¦ã‚“ã§ã„ã¾ã™ã€‚æ•°å­¦ã¨è¨ˆç®—ã®åŸºç¤Žã¨èŠ¸è¡“çš„å´é¢ã‚’çµ„ã¿åˆã‚ã›ã€éŸ³æ¥½ã‚„ã‚µã‚¦ãƒ³ãƒ‰å‡¦ç†ã«å¿œç”¨ã•ã‚Œã‚‹AIã€è¨€èªžå­¦ç¿’ãƒ„ãƒ¼ãƒ«ã«èˆˆå‘³ãŒã‚ã‚Šã¾ã™ã€‚",
      // About section
      "Sobre MÃ­": "è‡ªå·±ç´¹ä»‹",
      "ðŸ”¬ InvestigaciÃ³n": "ðŸ”¬ ç ”ç©¶",
      "ðŸŽµ Intereses": "ðŸŽµ èˆˆå‘³",
      "Participo en el": "ç§ã¯",
      "SIMG â€” Seminario de InvestigaciÃ³n en Modelos Generativos": "SIMG â€” ç”Ÿæˆãƒ¢ãƒ‡ãƒ«ç ”ç©¶ã‚»ãƒŸãƒŠãƒ¼",
      ", donde exploramos Deep Learning, TopologÃ­a, TeorÃ­a de la InformaciÃ³n y Probabilidad.": "ã«å‚åŠ ã—ã¦ã„ã¾ã™ã€‚ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°ã€ãƒˆãƒãƒ­ã‚¸ãƒ¼ã€æƒ…å ±ç†è«–ã€ç¢ºçŽ‡è«–ã‚’æŽ¢æ±‚ã—ã¦ã„ã¾ã™ã€‚",
      // Interests
      "MÃºsica + IA:": "éŸ³æ¥½ + AI:",
      "GeneraciÃ³n de audio con modelos generativos": "ç”Ÿæˆãƒ¢ãƒ‡ãƒ«ã«ã‚ˆã‚‹ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªç”Ÿæˆ",
      "NLP:": "è‡ªç„¶è¨€èªžå‡¦ç†:",
      "Procesamiento de lenguaje para japonÃ©s y chino": "æ—¥æœ¬èªžã¨ä¸­å›½èªžã®è¨€èªžå‡¦ç†",
      "Seguridad:": "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£:",
      "Ciberseguridad y programaciÃ³n competitiva": "ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ç«¶æŠ€ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°",
      // Blog section
      "Blog & Publicaciones": "ãƒ–ãƒ­ã‚° & å‡ºç‰ˆç‰©",
      // Contact section
      "Contacto": "é€£çµ¡å…ˆ",
      "ðŸ“± Otras formas de contacto": "ðŸ“± ä»–ã®é€£çµ¡æ–¹æ³•",
      "ðŸŒ Redes Sociales": "ðŸŒ ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒ¡ãƒ‡ã‚£ã‚¢",
      "Email Personal": "å€‹äººãƒ¡ãƒ¼ãƒ«",
      "Email AcadÃ©mico": "å¤§å­¦ãƒ¡ãƒ¼ãƒ«",
      // Navigation
      "Inicio": "ãƒ›ãƒ¼ãƒ ",
      "Blog": "ãƒ–ãƒ­ã‚°",
      "Publicaciones": "å‡ºç‰ˆç‰©",
    },
    zh: {
      // Hero info labels
      "Studying:": "å°±è¯»:",
      "CV:": "ç®€åŽ†:",
      "Website:": "ç½‘ç«™:",
      "Email:": "é‚®ç®±:",
      "City:": "åŸŽå¸‚:",
      "Computer Science Undergrad": "è®¡ç®—æœºç§‘å­¦æœ¬ç§‘ç”Ÿ",
      // Bio
      "Actualmente curso Ciencias de la ComputaciÃ³n en la": "ç›®å‰å°±è¯»äºŽ",
      "UNAL": "å“¥ä¼¦æ¯”äºšå›½ç«‹å¤§å­¦",
      ". Mi formaciÃ³n combina fundamentos matemÃ¡ticos y computacionales con aspectos artÃ­sticos, resultando en interÃ©s en el Ã¡rea de IA aplicada a la mÃºsica o procesamiento de sonido, y herramientas para el aprendizaje de idiomas.": "è®¡ç®—æœºç§‘å­¦ä¸“ä¸šã€‚æˆ‘çš„æ•™è‚²ç»“åˆäº†æ•°å­¦å’Œè®¡ç®—åŸºç¡€ä¸Žè‰ºæœ¯æ–¹é¢ï¼Œå¯¹éŸ³ä¹æˆ–å£°éŸ³å¤„ç†ä¸­çš„AIåº”ç”¨ä»¥åŠè¯­è¨€å­¦ä¹ å·¥å…·äº§ç”Ÿäº†å…´è¶£ã€‚",
      // About section
      "Sobre MÃ­": "å…³äºŽæˆ‘",
      "ðŸ”¬ InvestigaciÃ³n": "ðŸ”¬ ç ”ç©¶",
      "ðŸŽµ Intereses": "ðŸŽµ å…´è¶£",
      "Participo en el": "æˆ‘å‚åŠ ",
      "SIMG â€” Seminario de InvestigaciÃ³n en Modelos Generativos": "SIMG â€” ç”Ÿæˆæ¨¡åž‹ç ”ç©¶ç ”è®¨ä¼š",
      ", donde exploramos Deep Learning, TopologÃ­a, TeorÃ­a de la InformaciÃ³n y Probabilidad.": "ï¼ŒæŽ¢ç´¢æ·±åº¦å­¦ä¹ ã€æ‹“æ‰‘å­¦ã€ä¿¡æ¯è®ºå’Œæ¦‚çŽ‡è®ºã€‚",
      // Interests
      "MÃºsica + IA:": "éŸ³ä¹ + AI:",
      "GeneraciÃ³n de audio con modelos generativos": "ä½¿ç”¨ç”Ÿæˆæ¨¡åž‹è¿›è¡ŒéŸ³é¢‘ç”Ÿæˆ",
      "NLP:": "è‡ªç„¶è¯­è¨€å¤„ç†:",
      "Procesamiento de lenguaje para japonÃ©s y chino": "æ—¥è¯­å’Œä¸­æ–‡çš„è¯­è¨€å¤„ç†",
      "Seguridad:": "å®‰å…¨:",
      "Ciberseguridad y programaciÃ³n competitiva": "ç½‘ç»œå®‰å…¨å’Œç«žæŠ€ç¼–ç¨‹",
      // Blog section
      "Blog & Publicaciones": "åšå®¢ & å‡ºç‰ˆç‰©",
      // Contact section
      "Contacto": "è”ç³»æ–¹å¼",
      "ðŸ“± Otras formas de contacto": "ðŸ“± å…¶ä»–è”ç³»æ–¹å¼",
      "ðŸŒ Redes Sociales": "ðŸŒ ç¤¾äº¤åª’ä½“",
      "Email Personal": "ä¸ªäººé‚®ç®±",
      "Email AcadÃ©mico": "å­¦æ ¡é‚®ç®±",
      // Navigation
      "Inicio": "é¦–é¡µ",
      "Blog": "åšå®¢",
      "Publicaciones": "å‡ºç‰ˆç‰©",
    }
  };

  // Get stored language or default to 'es'
  const storedLang = localStorage.getItem('preferredLanguage') || 'es';
  let currentLang = storedLang;

  // DOM elements
  const globeBtn = document.getElementById('globeToggle');
  const dropdown = document.getElementById('langDropdown');
  const langOptions = document.querySelectorAll('.lang-option');

  // Set initial active state
  langOptions.forEach(opt => {
    if ((opt as HTMLElement).dataset.lang === currentLang) {
      opt.classList.add('active');
    }
  });

  // Toggle dropdown
  globeBtn?.addEventListener('click', (e) => {
    e.stopPropagation();
    dropdown?.classList.toggle('open');
  });

  // Close dropdown when clicking outside
  document.addEventListener('click', () => {
    dropdown?.classList.remove('open');
  });

  // Language selection
  langOptions.forEach(option => {
    option.addEventListener('click', (e) => {
      e.stopPropagation();
      const lang = (option as HTMLElement).dataset.lang || 'es';
      
      // Update active state
      langOptions.forEach(opt => opt.classList.remove('active'));
      option.classList.add('active');
      
      // Store preference
      localStorage.setItem('preferredLanguage', lang);
      currentLang = lang;
      
      // Apply translations
      applyTranslations(lang);
      
      // Close dropdown
      dropdown?.classList.remove('open');
    });
  });

  // Apply translations function
  function applyTranslations(lang: string) {
    const langTranslations = translations[lang];
    if (!langTranslations) return;

    // Get all text nodes and translate
    const walker = document.createTreeWalker(
      document.body,
      NodeFilter.SHOW_TEXT,
      null
    );

    const textNodes: Text[] = [];
    let node;
    while (node = walker.nextNode()) {
      textNodes.push(node as Text);
    }

    // For each text node, check if we have a translation
    textNodes.forEach(textNode => {
      const text = textNode.textContent?.trim();
      if (text && langTranslations[text]) {
        textNode.textContent = textNode.textContent?.replace(text, langTranslations[text]) || textNode.textContent;
      }
    });

    // Also update any data attributes or specific elements
    document.querySelectorAll('[data-translate]').forEach(el => {
      const key = el.getAttribute('data-translate');
      if (key && langTranslations[key]) {
        el.textContent = langTranslations[key];
      }
    });
  }

  // Apply stored language on load
  if (storedLang !== 'es') {
    applyTranslations(storedLang);
  }
</script>
