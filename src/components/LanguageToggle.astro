---
// Globe-based language toggle with translation support
// Supports: ES, EN, æ—¥æœ¬èªž, ä¸­æ–‡
---

<div class="lang-toggle-container">
  <button class="globe-btn" id="globeToggle" title="Change Language">
    <img src="/world.png" alt="Language" class="globe-icon" />
  </button>
  
  <!-- Dropdown menu -->
  <div class="lang-dropdown" id="langDropdown">
    <button class="lang-option" data-lang="es">
      <span class="lang-flag">ðŸ‡ªðŸ‡¸</span>
      <span>EspaÃ±ol</span>
    </button>
    <button class="lang-option" data-lang="en">
      <span class="lang-flag">ðŸ‡ºðŸ‡¸</span>
      <span>English</span>
    </button>
    <button class="lang-option" data-lang="ja">
      <span class="lang-flag">ðŸ‡¯ðŸ‡µ</span>
      <span>æ—¥æœ¬èªž</span>
    </button>
    <button class="lang-option" data-lang="zh">
      <span class="lang-flag">ðŸ‡¨ðŸ‡³</span>
      <span>ä¸­æ–‡</span>
    </button>
  </div>
</div>

<style>
  .lang-toggle-container {
    position: relative;
  }

  .globe-btn {
    background: transparent;
    border: 2px solid rgba(100, 116, 139, 0.3);
    border-radius: 50%;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
    padding: 4px;
  }

  .globe-btn:hover {
    border-color: rgba(59, 130, 246, 0.5);
    background: rgba(59, 130, 246, 0.1);
    transform: scale(1.05);
  }

  .globe-icon {
    width: 22px;
    height: 22px;
    object-fit: contain;
  }

  .lang-dropdown {
    position: absolute;
    top: 100%;
    right: 0;
    margin-top: 0.5rem;
    background: rgba(15, 23, 42, 0.95);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(100, 116, 139, 0.3);
    border-radius: 0.75rem;
    padding: 0.5rem;
    min-width: 140px;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.2s ease;
    z-index: 100;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
  }

  .lang-dropdown.open {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .lang-option {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    width: 100%;
    padding: 0.6rem 0.75rem;
    background: transparent;
    border: none;
    color: #cbd5e1;
    font-size: 0.875rem;
    font-family: inherit;
    cursor: pointer;
    border-radius: 0.5rem;
    transition: all 0.15s ease;
    text-align: left;
  }

  .lang-option:hover {
    background: rgba(59, 130, 246, 0.15);
    color: #ffffff;
  }

  .lang-option.active {
    background: rgba(59, 130, 246, 0.2);
    color: #60a5fa;
  }

  .lang-flag {
    font-size: 1.1rem;
  }

  @media (max-width: 640px) {
    .globe-btn {
      width: 32px;
      height: 32px;
    }

    .globe-icon {
      width: 18px;
      height: 18px;
    }
  }
</style>

<script>
  // Translations object
  const translations: Record<string, Record<string, string>> = {
    es: {
      // Hero
      "Computer Science Undergrad": "Estudiante de Ciencias de la ComputaciÃ³n",
      // About section
      "Sobre MÃ­": "Sobre MÃ­",
      "ðŸŽ“ FormaciÃ³n": "ðŸŽ“ FormaciÃ³n",
      "ðŸ”¬ InvestigaciÃ³n": "ðŸ”¬ InvestigaciÃ³n",
      "ðŸŽµ Intereses": "ðŸŽµ Intereses",
      // Blog section
      "Blog & Publicaciones": "Blog & Publicaciones",
      // Contact section
      "Contacto": "Contacto",
      "ðŸ“± Otras formas de contacto": "ðŸ“± Otras formas de contacto",
      "ðŸŒ Redes Sociales": "ðŸŒ Redes Sociales",
      "Email Personal": "Email Personal",
      "Email AcadÃ©mico": "Email AcadÃ©mico",
      // Navigation
      "Inicio": "Inicio",
      "Blog": "Blog",
    },
    en: {
      // Hero
      "Computer Science Undergrad": "Computer Science Undergrad",
      "Estudiante de Ciencias de la ComputaciÃ³n en la": "Computer Science student at",
      "Universidad Nacional de Colombia": "National University of Colombia",
      "Enfocado en la intersecciÃ³n de IA, mÃºsica y aprendizaje de idiomas.": "Focused on the intersection of AI, music, and language learning.",
      // About section
      "Sobre MÃ­": "About Me",
      "ðŸŽ“ FormaciÃ³n": "ðŸŽ“ Education",
      "ðŸ”¬ InvestigaciÃ³n": "ðŸ”¬ Research",
      "ðŸŽµ Intereses": "ðŸŽµ Interests",
      "Actualmente curso Ciencias de la ComputaciÃ³n en la UNAL. Mi formaciÃ³n combina fundamentos matemÃ¡ticos y computacionales con intereses creativos en IA aplicada a la mÃºsica y herramientas para el aprendizaje de idiomas.": "Currently studying Computer Science at UNAL. My education combines mathematical and computational foundations with creative interests in AI applied to music and language learning tools.",
      "donde exploramos Deep Learning, TopologÃ­a, TeorÃ­a de la InformaciÃ³n y Probabilidad.": "where we explore Deep Learning, Topology, Information Theory and Probability.",
      "Participo en el": "I participate in the",
      // Interests
      "MÃºsica + IA:": "Music + AI:",
      "GeneraciÃ³n de audio con modelos generativos": "Audio generation with generative models",
      "NLP:": "NLP:",
      "Procesamiento de lenguaje para japonÃ©s y chino": "Language processing for Japanese and Chinese",
      "Seguridad:": "Security:",
      "Ciberseguridad y programaciÃ³n competitiva": "Cybersecurity and competitive programming",
      // Blog section
      "Blog & Publicaciones": "Blog & Publications",
      // Contact section
      "Contacto": "Contact",
      "Â¿Tienes alguna pregunta o propuesta? Â¡No dudes en escribirme! Estoy abierto a colaboraciones, discusiones tÃ©cnicas y nuevas oportunidades.": "Have a question or proposal? Don't hesitate to reach out! I'm open to collaborations, technical discussions, and new opportunities.",
      "ðŸ“± Otras formas de contacto": "ðŸ“± Other ways to contact",
      "ðŸŒ Redes Sociales": "ðŸŒ Social Media",
      "Email Personal": "Personal Email",
      "Email AcadÃ©mico": "Academic Email",
      // Navigation
      "Inicio": "Home",
      "Blog": "Blog",
    },
    ja: {
      // Hero
      "Computer Science Undergrad": "ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹å­¦éƒ¨ç”Ÿ",
      "Estudiante de Ciencias de la ComputaciÃ³n en la": "ã®è¨ˆç®—æ©Ÿç§‘å­¦ã®å­¦ç”Ÿ",
      "Universidad Nacional de Colombia": "ã‚³ãƒ­ãƒ³ãƒ“ã‚¢å›½ç«‹å¤§å­¦",
      "Enfocado en la intersecciÃ³n de IA, mÃºsica y aprendizaje de idiomas.": "AIã€éŸ³æ¥½ã€è¨€èªžå­¦ç¿’ã®äº¤å·®ç‚¹ã«ç„¦ç‚¹ã‚’å½“ã¦ã¦ã„ã¾ã™ã€‚",
      // About section
      "Sobre MÃ­": "è‡ªå·±ç´¹ä»‹",
      "ðŸŽ“ FormaciÃ³n": "ðŸŽ“ å­¦æ­´",
      "ðŸ”¬ InvestigaciÃ³n": "ðŸ”¬ ç ”ç©¶",
      "ðŸŽµ Intereses": "ðŸŽµ èˆˆå‘³",
      // Blog section
      "Blog & Publicaciones": "ãƒ–ãƒ­ã‚° & å‡ºç‰ˆç‰©",
      // Contact section
      "Contacto": "é€£çµ¡å…ˆ",
      "ðŸ“± Otras formas de contacto": "ðŸ“± ä»–ã®é€£çµ¡æ–¹æ³•",
      "ðŸŒ Redes Sociales": "ðŸŒ ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒ¡ãƒ‡ã‚£ã‚¢",
      "Email Personal": "å€‹äººãƒ¡ãƒ¼ãƒ«",
      "Email AcadÃ©mico": "å¤§å­¦ãƒ¡ãƒ¼ãƒ«",
      // Navigation
      "Inicio": "ãƒ›ãƒ¼ãƒ ",
      "Blog": "ãƒ–ãƒ­ã‚°",
    },
    zh: {
      // Hero
      "Computer Science Undergrad": "è®¡ç®—æœºç§‘å­¦æœ¬ç§‘ç”Ÿ",
      "Estudiante de Ciencias de la ComputaciÃ³n en la": "åœ¨è¯»è®¡ç®—æœºç§‘å­¦å­¦ç”Ÿ",
      "Universidad Nacional de Colombia": "å“¥ä¼¦æ¯”äºšå›½ç«‹å¤§å­¦",
      "Enfocado en la intersecciÃ³n de IA, mÃºsica y aprendizaje de idiomas.": "ä¸“æ³¨äºŽäººå·¥æ™ºèƒ½ã€éŸ³ä¹å’Œè¯­è¨€å­¦ä¹ çš„äº¤æ±‡ç‚¹ã€‚",
      // About section
      "Sobre MÃ­": "å…³äºŽæˆ‘",
      "ðŸŽ“ FormaciÃ³n": "ðŸŽ“ æ•™è‚²",
      "ðŸ”¬ InvestigaciÃ³n": "ðŸ”¬ ç ”ç©¶",
      "ðŸŽµ Intereses": "ðŸŽµ å…´è¶£",
      // Blog section
      "Blog & Publicaciones": "åšå®¢ & å‡ºç‰ˆç‰©",
      // Contact section
      "Contacto": "è”ç³»æ–¹å¼",
      "ðŸ“± Otras formas de contacto": "ðŸ“± å…¶ä»–è”ç³»æ–¹å¼",
      "ðŸŒ Redes Sociales": "ðŸŒ ç¤¾äº¤åª’ä½“",
      "Email Personal": "ä¸ªäººé‚®ç®±",
      "Email AcadÃ©mico": "å­¦æ ¡é‚®ç®±",
      // Navigation
      "Inicio": "é¦–é¡µ",
      "Blog": "åšå®¢",
    }
  };

  // Get stored language or default to 'es'
  const storedLang = localStorage.getItem('preferredLanguage') || 'es';
  let currentLang = storedLang;

  // DOM elements
  const globeBtn = document.getElementById('globeToggle');
  const dropdown = document.getElementById('langDropdown');
  const langOptions = document.querySelectorAll('.lang-option');

  // Set initial active state
  langOptions.forEach(opt => {
    if ((opt as HTMLElement).dataset.lang === currentLang) {
      opt.classList.add('active');
    }
  });

  // Toggle dropdown
  globeBtn?.addEventListener('click', (e) => {
    e.stopPropagation();
    dropdown?.classList.toggle('open');
  });

  // Close dropdown when clicking outside
  document.addEventListener('click', () => {
    dropdown?.classList.remove('open');
  });

  // Language selection
  langOptions.forEach(option => {
    option.addEventListener('click', (e) => {
      e.stopPropagation();
      const lang = (option as HTMLElement).dataset.lang || 'es';
      
      // Update active state
      langOptions.forEach(opt => opt.classList.remove('active'));
      option.classList.add('active');
      
      // Store preference
      localStorage.setItem('preferredLanguage', lang);
      currentLang = lang;
      
      // Apply translations
      applyTranslations(lang);
      
      // Close dropdown
      dropdown?.classList.remove('open');
    });
  });

  // Apply translations function
  function applyTranslations(lang: string) {
    const langTranslations = translations[lang];
    if (!langTranslations) return;

    // Get all text nodes and translate
    const walker = document.createTreeWalker(
      document.body,
      NodeFilter.SHOW_TEXT,
      null
    );

    const textNodes: Text[] = [];
    let node;
    while (node = walker.nextNode()) {
      textNodes.push(node as Text);
    }

    // For each text node, check if we have a translation
    textNodes.forEach(textNode => {
      const text = textNode.textContent?.trim();
      if (text && langTranslations[text]) {
        textNode.textContent = textNode.textContent?.replace(text, langTranslations[text]) || textNode.textContent;
      }
    });

    // Also update any data attributes or specific elements
    document.querySelectorAll('[data-translate]').forEach(el => {
      const key = el.getAttribute('data-translate');
      if (key && langTranslations[key]) {
        el.textContent = langTranslations[key];
      }
    });
  }

  // Apply stored language on load
  if (storedLang !== 'es') {
    applyTranslations(storedLang);
  }
</script>
